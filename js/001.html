<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>001 关于 JavaScript this 指向 | 不肥的肥羊的博客</title>
    <meta name="description" content="Blog">
    <meta name="generator" content="VuePress 1.4.0">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?34ffe82902ef2e02b9f8f8642ace8775";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    
    <link rel="preload" href="/blog/assets/css/0.styles.de52748e.css" as="style"><link rel="preload" href="/blog/assets/js/app.62a48a99.js" as="script"><link rel="preload" href="/blog/assets/js/2.de018582.js" as="script"><link rel="preload" href="/blog/assets/js/13.9f1dca7d.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.34f50a32.js"><link rel="prefetch" href="/blog/assets/js/11.83174c0c.js"><link rel="prefetch" href="/blog/assets/js/12.01d0e66a.js"><link rel="prefetch" href="/blog/assets/js/14.59d3abd5.js"><link rel="prefetch" href="/blog/assets/js/15.c438921b.js"><link rel="prefetch" href="/blog/assets/js/16.146f5974.js"><link rel="prefetch" href="/blog/assets/js/17.fb5cb070.js"><link rel="prefetch" href="/blog/assets/js/18.dfae62b0.js"><link rel="prefetch" href="/blog/assets/js/19.7cd5580f.js"><link rel="prefetch" href="/blog/assets/js/20.544bbe10.js"><link rel="prefetch" href="/blog/assets/js/21.fe60465c.js"><link rel="prefetch" href="/blog/assets/js/22.f346de1c.js"><link rel="prefetch" href="/blog/assets/js/23.d6ef8734.js"><link rel="prefetch" href="/blog/assets/js/24.156f7dad.js"><link rel="prefetch" href="/blog/assets/js/3.f6fda1f0.js"><link rel="prefetch" href="/blog/assets/js/4.5c1e4e4d.js"><link rel="prefetch" href="/blog/assets/js/5.8f0aa699.js"><link rel="prefetch" href="/blog/assets/js/6.98a9e9e2.js"><link rel="prefetch" href="/blog/assets/js/7.830922ff.js"><link rel="prefetch" href="/blog/assets/js/8.8d1f4131.js"><link rel="prefetch" href="/blog/assets/js/9.a523d9cd.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.de52748e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">不肥的肥羊的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div> <a href="https://github.com/yyj08070631/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div> <a href="https://github.com/yyj08070631/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js/001.html" class="active sidebar-link">001 关于 JavaScript this 指向</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/js/001.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/js/001.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/js/001.html#取值规则" class="sidebar-link">取值规则</a></li><li class="sidebar-sub-header"><a href="/blog/js/001.html#原文栗子解析" class="sidebar-link">原文栗子解析</a></li><li class="sidebar-sub-header"><a href="/blog/js/001.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/blog/js/002.html" class="sidebar-link">002 模拟实现 call 和 apply</a></li><li><a href="/blog/js/003.html" class="sidebar-link">003 模拟实现 bind</a></li><li><a href="/blog/js/004.html" class="sidebar-link">004 模拟实现 new</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>构建生态</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web 安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>UI/UX</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_001-关于-javascript-this-指向"><a href="#_001-关于-javascript-this-指向" class="header-anchor">#</a> 001 关于 JavaScript this 指向</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>这篇文章的灵感来源于冴羽大佬的<a href="https://github.com/mqyqingfeng/Blog/issues/7" target="_blank" rel="noopener noreferrer">《JavaScript深入之从ECMAScript规范解读this》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>一文，这篇文章从 ES5 规范的角度解释了 <code>this</code> 指向的原理，下面的解析是从我的理解出发，重新梳理一下整个规则。</p> <blockquote><p>更详细具体的解释，可以阅读 ES5 文档：<br>
英文版: <a href="http://es5.github.io" target="_blank" rel="noopener noreferrer">http://es5.github.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
中文版: <a href="http://yanhaijing.com/es5" target="_blank" rel="noopener noreferrer">http://yanhaijing.com/es5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <h3 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h3> <p>可以理解为对对象属性的解析。它属于一种仅存在于文档中的概念模型，仅用于帮助理解 ES 的底层实现，在实际 JS 代码中并不存在。</p> <p>翻译文档中的描述 (8.7)：一个 <code>Reference</code> 由三部分组成，<code>base value</code>, <code>referenced name</code> 以及 <code>strict reference</code>，本规范使用以下的抽象操作访问 <code>Reference</code> 的组成部分，（此处只列举本文中用到的操作名）<code>GetBase</code>, <code>IsPropertyReference</code>, <code>GetValue</code>。</p> <h3 id="base-value"><a href="#base-value" class="header-anchor">#</a> base value</h3> <p>可以理解为属性名所在的上下文，如果是对象的属性，那么 <code>base value</code> 就是这个对象；如果是一个变量，那么 <code>base value</code> 就是变量所处的环境，变量环境在文档中有一个类型叫做 <code>Environment Record</code>；如果引用了一个无法触达的属性，<code>base value</code> 就会是 <code>undefined</code>。</p> <p>翻译文档中的描述 (8.7)：<code>base value</code> 的类型可以是 <code>undefined</code>, <code>Object</code>, <code>Boolean</code>, <code>String</code>, <code>Number</code> 或者 <code>Environment Record</code>，如果 <code>base value</code> 的值为 <code>undefined</code>，这个 <code>Reference</code> 就不能被解析为一个属性绑定。</p> <h3 id="referenced-name"><a href="#referenced-name" class="header-anchor">#</a> referenced name</h3> <p>字符串，表示 <code>Reference</code> 的名称。</p> <h3 id="strict-reference"><a href="#strict-reference" class="header-anchor">#</a> strict reference</h3> <p>这是一个与严格模式作用域有关的 component，在本文中没啥用。<a href="https://stackoverflow.com/questions/11698901/whats-the-meaning-of-strict-reference-flag-in-ecma-5-262" target="_blank" rel="noopener noreferrer">参考来源 (stack overflow)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="getbase"><a href="#getbase" class="header-anchor">#</a> GetBase</h3> <p>获取 <code>Reference</code> 的 <code>base value</code>。</p> <h3 id="ispropertyreference"><a href="#ispropertyreference" class="header-anchor">#</a> IsPropertyReference</h3> <p>如果 <code>base value</code> 是一个对象，它就会返回 <code>true</code>。</p> <h3 id="getvalue"><a href="#getvalue" class="header-anchor">#</a> GetValue</h3> <p>返回对象属性保存的真实值。</p> <h3 id="implicitthisvalue"><a href="#implicitthisvalue" class="header-anchor">#</a> ImplicitThisValue</h3> <p>这是 <code>Environment Record</code> 的一个操作，一般情况下返回 <code>undefined</code>，理解这篇文章只需要当它始终返回 <code>undefined</code> 即可。</p> <p>详情可在文档中搜索 ImplicitThisValue，查看所有的规则，或者简单参考<a href="https://stackoverflow.com/questions/29375931/why-is-type-of-calling-function-not-reference-in-javascriptecma-262-5-1" target="_blank" rel="noopener noreferrer">这个回答 (stack overflow)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="取值规则"><a href="#取值规则" class="header-anchor">#</a> 取值规则</h2> <p>原文根据文档 11.2.3 Function Calls 章节的描述整理出了判断 <code>this</code> 取值的规则：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> 计算 MemberExpression 的结果赋值给 ref
<span class="token number">2.</span> 判断 ref 是不是一个 Reference 类型
<span class="token number">2.1</span> 如果 ref 是 Reference，并且 <span class="token function">IsPropertyReference</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span> 是 <span class="token boolean">true</span><span class="token punctuation">,</span> 那么 <span class="token keyword">this</span> 的值为 <span class="token function">GetBase</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span>
<span class="token number">2.2</span> 如果 ref 是 Reference，并且 base value 值是 Environment Record<span class="token punctuation">,</span> 那么 <span class="token keyword">this</span> 的值为 <span class="token function">ImplicitThisValue</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span>
<span class="token number">2.3</span> 如果 ref 不是 Reference，那么 <span class="token keyword">this</span> 的值为 <span class="token keyword">undefined</span>
</code></pre></div><h3 id="_1-计算-memberexpression"><a href="#_1-计算-memberexpression" class="header-anchor">#</a> 1. 计算 MemberExpression...</h3> <p>这里的 <code>MemberExpression</code> 可以理解为获取函数的表达式，而 <code>ref</code> 则是这个表达式的计算结果。</p> <p>再简单一些的理解，就是标识函数执行的括号对左边的代码，比如 <code>(false || foo.bar)()</code>，<code>MemberExpression</code> 就是 <code>(false || foo.bar)</code>。</p> <h3 id="_2-判断-ref-是不是一个-reference"><a href="#_2-判断-ref-是不是一个-reference" class="header-anchor">#</a> 2. 判断 ref 是不是一个 Reference...</h3> <p>这个在原文里有提到，其实就是对照文档中对每种 <code>MemberExpression</code> 的描述，看看返回的结果是不是一个 <code>Reference</code> 类型。</p> <h3 id="_2-1-如果-ref-是-reference，并且-is"><a href="#_2-1-如果-ref-是-reference，并且-is" class="header-anchor">#</a> 2.1 如果 ref 是 Reference，并且 Is...</h3> <p>如果 <code>ref</code> 属于 <code>Reference</code> 类型，且 <code>base value</code> 是一个对象，那么 <code>this</code> 的值就是 <code>base value</code> 中的对象。</p> <p>这种情况就是取对象中的属性，那么 <code>this</code> 的指向就是这个对象，这也是使用 <code>this</code> 最常见的一种情况。</p> <h3 id="_2-2-如果-ref-是-reference，并且-ba"><a href="#_2-2-如果-ref-是-reference，并且-ba" class="header-anchor">#</a> 2.2 如果 ref 是 Reference，并且 ba...</h3> <p>如果 <code>ref</code> 属于 <code>Reference</code> 类型，且 <code>base value</code> 是一个环境，那么 <code>this</code> 的值就是 <code>undefined</code>，在严格模式下，<code>undefined</code> 会被重写为全局变量。</p> <p>这种情况就是声明全局变量，<code>this</code> 会指向 <code>window</code>。全局变量与对象属性是分析 <code>this</code> 的文章中最常见的栗子，文章一般会将这种情况解释为 <code>this</code> 指向的是函数声明的位置，如果在对象中声明，那么 <code>this</code> 就指向这个对象，如果在全局声明，那就指向全局变量。事实上这种说法是有缺陷的，它无法解释 2.3 中的行为。</p> <h3 id="_2-3-如果-ref-不是-reference"><a href="#_2-3-如果-ref-不是-reference" class="header-anchor">#</a> 2.3 如果 ref 不是 Reference...</h3> <p>如果 <code>ref</code> 不属于 <code>Reference</code> 类型，那么 <code>this</code> 的值就是 <code>undefined</code>，在严格模式下，<code>undefined</code> 会被重写为全局变量。</p> <p>这种情况对应了原文中的三个栗子 <code>(foo.bar = foo.bar)()</code>, <code>(false || foo.bar)()</code>, <code>(foo.bar, foo.bar)()</code>，由于获取函数的 <code>MemberExpression</code> 不是简单的对象属性或者全局变量，因此完全无法用声明位置的说法来解释其 <code>this</code> 指向，此时应该查阅文档，看看表达式最终返回的值是否 <code>Reference</code>，才能确定最终的 <code>this</code> 指向。</p> <h2 id="原文栗子解析"><a href="#原文栗子解析" class="header-anchor">#</a> 原文栗子解析</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 示例 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 示例 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 示例 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar <span class="token operator">=</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 示例 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">||</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 示例 5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">,</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="foo-bar"><a href="#foo-bar" class="header-anchor">#</a> foo.bar()</h3> <blockquote><p>11.2.1 Property Accessors<br>
Return a value of type Reference whose base value is baseValue and whose referenced name is propertyNameString, and whose strict mode flag is strict.</p></blockquote> <p>根据描述得知返回的对象就是 <code>Reference</code>，而 <code>MemberExpression</code> 是访问了一个对象的属性，因此符合 2.1 中的描述，<code>this</code> 应该指向函数所在的对象 <code>foo</code>。</p> <h3 id="foo-bar-2"><a href="#foo-bar-2" class="header-anchor">#</a> (foo.bar)()</h3> <blockquote><p>11.1.6 The Grouping Operator<br>
The production PrimaryExpression : ( Expression ) is evaluated as follows:<br>
Return the result of evaluating Expression. This may be of type Reference.<br>
NOTE: This algorithm does not apply GetValue to the result of evaluating Expression. The principal motivation for this is so that operators such as delete and typeof may be applied to parenthesised expressions.</p></blockquote> <p>根据描述，括号运算符不会对内部的的表达式产生影响，其存在的意义是为了处理像 <code>delete</code> 和 <code>typeof</code> 这样的表达式，因此这题与上一题答案一样，<code>this</code> 指向 <code>foo</code>。</p> <h3 id="foo-bar-foo-bar"><a href="#foo-bar-foo-bar" class="header-anchor">#</a> (foo.bar = foo.bar)()</h3> <blockquote><p>11.13.1 Simple Assignment ( = )<br>
3. Let rval be GetValue(rref).<br>
5. Return rval.</p></blockquote> <p>根据描述赋值符号返回的不是 <code>Reference</code>，而是对右边表达式 <code>GetValue()</code> 的结果，因此符合 2.3 的描述，<code>this</code> 为 <code>undefined</code>，在严格模式下，<code>undefined</code> 会被重写为全局变量。</p> <h3 id="false-foo-bar"><a href="#false-foo-bar" class="header-anchor">#</a> (false || foo.bar)()</h3> <blockquote><p>11.11 Binary Logical Operators<br>
The production LogicalORExpression : LogicalORExpression || LogicalANDExpression is evaluated as follows:<br>
5. Return GetValue(rref).</p></blockquote> <p>根据描述赋值符号返回的不是 <code>Reference</code>，而是对右边表达式 <code>GetValue()</code> 的结果，因此与上题一样，<code>this</code> 指向全局变量。</p> <h3 id="foo-bar-foo-bar-2"><a href="#foo-bar-foo-bar-2" class="header-anchor">#</a> (foo.bar, foo.bar)()</h3> <blockquote><p>11.14 Comma Operator ( , )<br>
The production Expression : Expression , AssignmentExpression is evaluated as follows:
4. Return GetValue(rref).</p></blockquote> <p>根据描述赋值符号返回的不是 <code>Reference</code>，而是对右边表达式 <code>GetValue()</code> 的结果，因此与上题一样，<code>this</code> 指向全局变量。</p> <h3 id="答案总结"><a href="#答案总结" class="header-anchor">#</a> 答案总结</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar <span class="token operator">=</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">||</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">,</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><h3 id="其他例子"><a href="#其他例子" class="header-anchor">#</a> 其他例子</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 11.12 Conditional Operator ( ? : )</span>
<span class="token comment">// The production ConditionalExpression : LogicalORExpression ? AssignmentExpression : AssignmentExpression is evaluated as follows:</span>
<span class="token comment">// 1. Let lref be the result of evaluating LogicalORExpression.</span>
<span class="token comment">// 2. If ToBoolean(GetValue(lref)) is true, then</span>
<span class="token comment">//   a. Let trueRef be the result of evaluating the first AssignmentExpression.</span>
<span class="token comment">//   b. Return GetValue(trueRef).</span>
<span class="token comment">// 3. Else</span>
<span class="token comment">//   a. Let falseRef be the result of evaluating the second AssignmentExpression.</span>
<span class="token comment">//   b. Return GetValue(falseRef).</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>总的来说，“<code>this</code> 指向的是函数声明的位置”这种说法说对了大部分的情况，但在函数是通过表达式计算得来时，就无法解释了，因此使用 <code>Reference</code> 模型来分析 <code>this</code> 指向还是很有必要的。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yyj08070631/blog/edit/master/docs/js/001.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/12/2020, 4:38:02 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/js/002.html">
        002 模拟实现 call 和 apply
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.62a48a99.js" defer></script><script src="/blog/assets/js/2.de018582.js" defer></script><script src="/blog/assets/js/13.9f1dca7d.js" defer></script>
  </body>
</html>
