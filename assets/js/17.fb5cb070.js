(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{278:function(e,t,n){"use strict";n.r(t);var a=n(28),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"_003-http-头部：内容协商"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_003-http-头部：内容协商"}},[e._v("#")]),e._v(" 003 HTTP 头部：内容协商")]),e._v(" "),n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[e._v("#")]),e._v(" 概述")]),e._v(" "),n("p",[e._v("在 HTTP 协议中，内容协商是这样一种机制，通过为同一 URI 指向的资源提供不同的展现形式，可以使用户代理选择与用户需求相适应的最佳匹配（例如，文档使用的自然语言，图片的格式，或者内容编码形式）。")]),e._v(" "),n("p",[e._v("在日常开发中最常用的协商机制称为“服务端驱动型内容协商机制”，在服务端驱动型协商机制或者主动协商机制中，浏览器（或者其他任何类型的用户代理）会随同 URL 发送一系列的消息头。这些消息头描述了用户倾向的选择。服务器则以此为线索，通过内部算法来选择最佳方案提供给客户端。相关算法与具体的服务器相关，并没有在规范中进行规定。例如这里有一份 "),n("a",{attrs:{href:"http://httpd.apache.org/docs/2.2/en/content-negotiation.html#algorithm",target:"_blank",rel:"noopener noreferrer"}},[e._v("Apache 2.2 服务器的内容协商算法"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("p",[e._v("HTTP/1.1 规范指定了一系列的标准消息头用于启动服务端驱动型内容协商 （Accept、Accept-Charset、 Accept-Encoding、Accept-Language）。下面将逐一介绍每个头部对应的功能。")]),e._v(" "),n("h2",{attrs:{id:"accept、accept-charset-与-content-type"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#accept、accept-charset-与-content-type"}},[e._v("#")]),e._v(" Accept、Accept-Charset 与 Content-Type")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept",target:"_blank",rel:"noopener noreferrer"}},[e._v("Accept 头部"),n("OutboundLink")],1),e._v(" 列举了用户代理希望接收的媒体资源的 MIME 类型。其中不同的 MIME 类型之间用逗号分隔，同时每一种 MIME 类型会配有一个可选的品质因数 q，该参数明确了不同 MIME 类型之间的相对优先级。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# 示例\nAccept: text/html\nAccept: image/*\nAccept: text/html, application/xhtml+xml, application/xml;q=0.9, */*;q=0.8\n")])])]),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Charset",target:"_blank",rel:"noopener noreferrer"}},[e._v("Accept-Charset 头部"),n("OutboundLink")],1),e._v(" 用于告知服务器该客户代理可以理解何种形式的字符编码。按照传统，不同地区用户使用的的浏览器会被赋予不同的值，比如说西欧地区用户使用的浏览器中，该首部的值可能会是 "),n("code",[e._v("ISO-8859-1,utf-8;q=0.7,*;q=0.7")]),e._v("。")]),e._v(" "),n("p",[e._v("但如今 UTF-8 编码已经得到了广泛的支持，成为首选的字符编码类型，"),n("a",{attrs:{href:"https://www.eff.org/deeplinks/2010/01/primer-information-theory-and-privacy",target:"_blank",rel:"noopener noreferrer"}},[e._v("为了通过减少基于配置信息的信息熵来更好地保护隐私信息"),n("OutboundLink")],1),e._v("， 大多数浏览器已经将 Accept-Charset 头部移除。")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Content-Type 头部"),n("OutboundLink")],1),e._v(" 则是服务端在接收到客户端提交的 Accept 头部之后，根据其内容协商算法计算出来的实际返回的内容类型，一般包括 MIME 类型与字符集类型。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Content-Type: text/html; charset=utf-8\nContent-Type: multipart/form-data; boundary=something\n")])])]),n("p",[e._v("这里有一种特殊情况会触发第三个参数 boundary 的提交，就是在通过 HTML form 提交生成的 POST 请求中，会携带声明了 boundary 属性的 Content-Type 头部：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('POST /foo HTTP/1.1\nContent-Length: 68137\nContent-Type: multipart/form-data; boundary=---------------------------974767299852498929531610575\n\n---------------------------974767299852498929531610575\nContent-Disposition: form-data; name="description" \n\nsome text\n---------------------------974767299852498929531610575\nContent-Disposition: form-data; name="myFile"; filename="foo.txt" \nContent-Type: text/plain \n\n(content of the uploaded file foo.txt)\n---------------------------974767299852498929531610575\n')])])]),n("p",[e._v("这里的 Content-Type 由 <form> 元素上的 "),n("code",[e._v("enctype")]),e._v(" 属性指定")]),e._v(" "),n("h2",{attrs:{id:"accept-encoding-与-content-encoding"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#accept-encoding-与-content-encoding"}},[e._v("#")]),e._v(" Accept-Encoding 与 Content-Encoding")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Encoding",target:"_blank",rel:"noopener noreferrer"}},[e._v("Accept-Encoding"),n("OutboundLink")],1),e._v(" 会将客户端能够理解的内容编码方式——通常是某种压缩算法通知给服务端。通过内容协商的方式，服务端会选择一个客户端提议的方式，使用并在响应头 "),n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Encoding",target:"_blank",rel:"noopener noreferrer"}},[e._v("Content-Encoding"),n("OutboundLink")],1),e._v(" 中通知客户端该选择。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# Accept-Encoding 头部的可选值\nAccept-Encoding: gzip\nAccept-Encoding: compress\nAccept-Encoding: deflate\nAccept-Encoding: br\nAccept-Encoding: identity\nAccept-Encoding: *\n\n// Multiple algorithms, weighted with the quality value syntax:\nAccept-Encoding: deflate, gzip;q=1.0, *;q=0.5\n")])])]),n("p",[e._v("Accept-Encoding 也支持通过品质因数 q 指定选择编码（压缩）方式的优先级。")]),e._v(" "),n("h2",{attrs:{id:"accept-language-与-content-language"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#accept-language-与-content-language"}},[e._v("#")]),e._v(" Accept-Language 与 Content-Language")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language",target:"_blank",rel:"noopener noreferrer"}},[e._v("Accept-Language"),n("OutboundLink")],1),e._v(" 请求头允许客户端声明它可以理解的自然语言，以及优先选择的区域方言。借助内容协商机制，服务器可以从诸多备选项中选择一项进行应用，并使用 "),n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Language",target:"_blank",rel:"noopener noreferrer"}},[e._v("Content-Language"),n("OutboundLink")],1),e._v(" 应答头通知客户端它的选择。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# 示例\nAccept-Language: de\nAccept-Language: de-CH\nAccept-Language: en-US,en;q=0.5\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\n")])])]),n("p",[e._v("Accept-Language 同样支持通过品质因数 q 指定选择语言的优先级。")]),e._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[e._v("部分参考来源")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Content_negotiation",target:"_blank",rel:"noopener noreferrer"}},[e._v("内容协商"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);