# 008 TLS 握手协议

[Keyless SSL: The Nitty Gritty Technical Details](https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/) 是 Cloudflare 发布 Keyless SSL 服务（即无需私钥的 HTTPS CDN 托管服务）的说明文档，它使用丰富的插图以及有条理的行文结构解释了 TLS 握手的过程。阮一峰老师也根据这篇文章编写了 [图解SSL/TLS协议](https://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html) 一文。

本文也会在这篇文章的基础上，结合一些其他的参考资料，梳理 TLS 握手的过程。

## 概述

TLS 握手一般分为 RSA 握手与 DH 握手，这两种握手的区别在于采用的加密套件（Cipher suite）的不同，这些概念将会在后面一一解释。

## RSA 握手

![RSA 握手过程](../image/00017.jpg)
> 图：RSA 握手过程

首先解释一下图中这些陌生的概念：

1. **加密套件（Cipher suite）**：这是一个由一组加密算法的名称组成的唯一标识符，在上图第 1 步中，用于客户端向服务端询问 TLS 通信采用的加密方案。以一个 RSA 握手的 Cipher suite 为例：

```
TLS_RSA_WITH_AES_128_GCM_SHA256
```

Cipher suite 的结构一般由四个算法组成：

- 一个密钥交换（Key Exchange）算法，生成用于双端交换的客户端随机数（Client random）与服务端随机数（Server random），在例子中就是 RSA。
- 一个认证（Authentication）算法，用于图中公钥加密


## DH 握手

![DH 握手过程](../image/00018.jpg)
> 图：DH 握手过程

::: tip 部分参考来源
[TLS 协议分析 与 现代加密通信协议设计](https://blog.helong.info/post/2015/09/06/tls-protocol-analysis-and-crypto-protocol-design/)

[Keyless SSL: The Nitty Gritty Technical Details](https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/)
:::
